<ion-header>
  <ion-toolbar color="primary">
    <ion-grid>
      <ion-row>
        <ion-col class="ion-text-center">
          <ion-button fill="clear" color="light" [routerLink]="['/home']">
            Inicio
          </ion-button>
        </ion-col>

        <ion-col class="ion-text-center">
          <ion-button fill="clear" color="light" [routerLink]="['/community']">
            Comunidad
          </ion-button>
        </ion-col>

        <ion-col class="ion-text-center">
          <!-- Muestra "Perfil" o "Iniciar Sesi√≥n" -->
          <ion-button fill="clear" color="light" (click)="onProfileButtonClick($event)">
            {{ isLoggedIn ? 'Perfil' : 'Iniciar Sesi√≥n' }}
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<!-- üîΩ Men√∫ desplegable -->
<ion-popover [isOpen]="showPopover" (didDismiss)="showPopover = false" [event]="popoverEvent">
  <ng-template>
    <ion-content>
      <ion-list>
        <ion-item button (click)="goToProfileFromMenu()">
          <ion-label>Ir al Perfil</ion-label>
        </ion-item>
        <ion-item button (click)="logout()">
          <ion-label>Cerrar Sesi√≥n</ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>

<ion-content class="ion-padding" color="tertiary">
  <!-- POST CARD -->
  <ion-card class="post-card" *ngIf="post">
    <ion-card-header>
      <ion-card-title class="post-title">{{ post.title }}</ion-card-title>
      <ion-card-subtitle class="post-author">por {{ post.username || 'Usuario' }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p class="post-content">
        {{ post.content }}
      </p>

      <!-- comment input + send -->
      <ion-item lines="none" class="write-box">
        <ion-input
          placeholder="Escribe un comentario"
          [(ngModel)]="newComment"
          clear-input
          (keyup)="onEnterPress($event)">
        </ion-input>

        <ion-button
          fill="clear"
          color="primary"
          (click)="sendComment()"
          [disabled]="!newComment.trim()">
          <ion-icon slot="icon-only" name="send-outline"></ion-icon>
        </ion-button>
      </ion-item>

      <!-- actions -->
      <div class="actions-row">
        <div class="left-actions">
          <ion-button fill="clear" size="small"
                      [disabled]="voting[post.postid]"
                      (click)="onVote(post, 'like')">
            <ion-icon name="thumbs-up-outline"></ion-icon>
            <span>{{ post.likes }}</span>
          </ion-button>

          <ion-button fill="clear" size="small"
                      [disabled]="voting[post.postid]"
                      (click)="onVote(post, 'dislike')">
            <ion-icon name="thumbs-down-outline"></ion-icon>
            <span>{{ post.dislikes }}</span>
          </ion-button>
        </div>


        <div class="right-actions">
          <ion-button fill="clear" (click)="toggleComments()">
            <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- COMMENTS -->
  <ion-card class="comments-card" *ngIf="showComments">
    <ion-card-header>
      <ion-card-title>Comentarios</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item lines="none" *ngFor="let c of comments">
          <ion-label>
            <h3 class="comment-author">{{ c.author }}</h3>
            <p class="comment-text">{{ c.text }}</p>
              <div class="vote-row">
                <ion-button fill="clear" size="small"
                            [disabled]="commentVoting[c.commentid]"
                            (click)="onVoteComment(c, 'like')">
                  <ion-icon name="thumbs-up-outline"></ion-icon>
                  <span>{{ c.likes }}</span>
                </ion-button>

                <ion-button fill="clear" size="small"
                            [disabled]="commentVoting[c.commentid]"
                            (click)="onVoteComment(c, 'dislike')">
                  <ion-icon name="thumbs-down-outline"></ion-icon>
                  <span>{{ c.dislikes }}</span>
                </ion-button>
              </div>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>
